<div class="container mx-auto">
  <!-- Report Generation Form -->
  <div class="bg-gray-800 rounded-lg p-6 mb-6 no-print">
    <h1 class="text-3xl font-bold text-white mb-4">Gerador de Relatórios</h1>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
      <div>
        <label for="start-date" class="block text-sm font-medium text-gray-300 mb-1">Data de Início</label>
        <input type="date" id="start-date" [value]="startDate()" (input)="startDate.set($any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
      </div>
      <div>
        <label for="end-date" class="block text-sm font-medium text-gray-300 mb-1">Data de Fim</label>
        <input type="date" id="end-date" [value]="endDate()" (input)="endDate.set($any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
      </div>
      <div>
        <label for="report-type" class="block text-sm font-medium text-gray-300 mb-1">Tipo de Relatório</label>
        <select id="report-type" [value]="reportType()" (change)="reportType.set($any($event.target).value)" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
          <option value="sales">Vendas</option>
          <option value="items">Itens Mais Vendidos</option>
        </select>
      </div>
      <button (click)="generateReport()" [disabled]="isLoading()" class="w-full bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-500 transition-colors disabled:bg-gray-600">
        Gerar Relatório
      </button>
    </div>
  </div>

  <!-- Report Display Area -->
  <div class="printable-area">
    @if (isLoading()) {
      <div class="flex items-center justify-center h-96 bg-gray-800 rounded-lg">
        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500"></div>
        <p class="ml-4 text-white">Gerando relatório...</p>
      </div>
    } @else if (generatedReport(); as report) {
      <div class="bg-gray-800 rounded-lg p-6">
        <div class="flex justify-between items-start mb-6">
          <div>
            <h2 class="text-2xl font-bold text-white">{{ reportTitle() }}</h2>
            <p class="text-gray-400">Período: {{ startDate() | date:'dd/MM/yyyy' }} a {{ endDate() | date:'dd/MM/yyyy' }}</p>
          </div>
          <button (click)="printReport()" class="no-print bg-gray-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-500 transition-colors flex items-center gap-2">
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6 3.129M6.72 13.829L6 3.129m0 10.7a48.45 48.45 0 0112 0m-12 0v.042m12 0v-.042m0 10.704l.72-10.7M17.28 13.829c.24.03.48.062.72.096m-.72-.096L18 3.129m-1.2 10.7l.72-10.7m0 10.7a48.45 48.45 0 00-12 0m12 0v.042m-12 0v-.042" /></svg>
            Imprimir
          </button>
        </div>
        
        @switch (reportType()) {
          @case ('sales') {
            <!-- Sales Report View -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
              <div class="bg-gray-700/50 rounded-lg p-4"><p class="text-gray-400 text-sm">Faturamento Bruto</p><p class="text-2xl font-bold text-white mt-1">{{ report.grossRevenue | currency:'BRL' }}</p></div>
              <div class="bg-gray-700/50 rounded-lg p-4"><p class="text-gray-400 text-sm">Total de Pedidos</p><p class="text-2xl font-bold text-white mt-1">{{ report.totalOrders }}</p></div>
              <div class="bg-gray-700/50 rounded-lg p-4"><p class="text-gray-400 text-sm">Ticket Médio</p><p class="text-2xl font-bold text-white mt-1">{{ report.averageTicket | currency:'BRL' }}</p></div>
            </div>
            <h3 class="text-lg font-semibold text-white mb-4">Resumo por Forma de Pagamento</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-left">
                <thead class="bg-gray-700/50 text-sm text-gray-300 uppercase"><tr><th class="px-6 py-3">Forma de Pagamento</th><th class="px-6 py-3 text-right">Valor Total</th></tr></thead>
                <tbody>
                  @for(item of report.paymentSummary; track item.method) {
                    <tr class="border-b border-gray-700">
                      <td class="px-6 py-4 font-medium text-white">{{ item.method }}</td>
                      <td class="px-6 py-4 text-right">{{ item.total | currency:'BRL' }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          }
          @case ('items') {
            <!-- Items Report View -->
            @if(report.bestSellingItems.length > 0) {
              <div class="overflow-x-auto">
                <table class="w-full text-left">
                  <thead class="bg-gray-700/50 text-sm text-gray-300 uppercase"><tr><th class="px-6 py-3">#</th><th class="px-6 py-3">Item</th><th class="px-6 py-3 text-right">Quantidade</th><th class="px-6 py-3 text-right">Receita Gerada</th></tr></thead>
                  <tbody>
                    @for(item of report.bestSellingItems; track item.name; let i = $index) {
                      <tr class="border-b border-gray-700">
                        <td class="px-6 py-4 font-medium text-white">{{ i + 1 }}</td>
                        <td class="px-6 py-4 font-medium text-white">{{ item.name }}</td>
                        <td class="px-6 py-4 text-right">{{ item.quantity }}</td>
                        <td class="px-6 py-4 text-right">{{ item.revenue | currency:'BRL' }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            } @else {
               <p class="text-center text-gray-500 py-16">Nenhum item vendido no período selecionado.</p>
            }
          }
        }
      </div>
    } @else {
      <div class="flex items-center justify-center h-96 bg-gray-800 rounded-lg">
        <div class="text-center">
          <svg class="mx-auto h-12 w-12 text-gray-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
          <h3 class="mt-2 text-sm font-medium text-gray-400">Nenhum relatório gerado</h3>
          <p class="mt-1 text-sm text-gray-500">Selecione um período e tipo de relatório para começar.</p>
        </div>
      </div>
    }
  </div>
</div>