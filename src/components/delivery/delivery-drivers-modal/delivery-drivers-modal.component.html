<div class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4" (click)="closeModal.emit()">
  <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="p-4 border-b border-gray-700 flex justify-between items-center">
      <h3 class="text-xl font-bold text-white">Gerenciar Entregadores</h3>
      <button (click)="closeModal.emit()" class="p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"></path></svg>
      </button>
    </div>

    <!-- Body -->
    <div class="flex-1 p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Left: Driver List -->
      <div class="md:col-span-2">
        <h4 class="text-lg font-semibold text-white mb-3">Entregadores Cadastrados</h4>
        @if (drivers().length === 0) {
          <p class="text-center text-gray-500 py-10">Nenhum entregador cadastrado.</p>
        } @else {
          <div class="space-y-3">
            @for (driver of drivers(); track driver.id) {
              <div class="bg-gray-700/50 p-3 rounded-lg flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-3 h-3 rounded-full" [class.bg-green-500]="driver.is_active" [class.bg-gray-500]="!driver.is_active" [title]="driver.is_active ? 'Ativo' : 'Inativo'"></div>
                  <div>
                    <p class="font-semibold text-white">{{ driver.name }}</p>
                    <p class="text-xs text-gray-400">{{ driver.vehicle_type || 'Veículo não informado' }} - {{ driver.phone || 'Telefone não informado' }}</p>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <button (click)="startEditing(driver)" class="p-2 text-blue-400 hover:text-blue-300">
                    <span class="material-symbols-outlined text-base">edit</span>
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Right: Add/Edit Form -->
      <div class="md:col-span-1">
        <h4 class="text-lg font-semibold text-white mb-3">{{ editingDriver() ? 'Editar Entregador' : 'Novo Entregador' }}</h4>
        <form (ngSubmit)="saveDriver()" class="space-y-4 bg-gray-900/50 p-4 rounded-lg">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Nome *</label>
            <input type="text" [(ngModel)]="driverForm().name" name="name" required class="w-full bg-gray-700 rounded p-2 text-white">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Telefone</label>
            <input type="tel" [(ngModel)]="driverForm().phone" name="phone" class="w-full bg-gray-700 rounded p-2 text-white">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Tipo de Veículo</label>
            <select [(ngModel)]="driverForm().vehicle_type" name="vehicle_type" class="w-full bg-gray-700 rounded p-2 text-white">
              <option>Moto</option>
              <option>Carro</option>
              <option>Bicicleta</option>
            </select>
          </div>
          <div class="flex items-center">
            <input type="checkbox" id="is_active" [(ngModel)]="driverForm().is_active" name="is_active" class="h-4 w-4 rounded border-gray-500 text-blue-600">
            <label for="is_active" class="ml-2 text-sm text-gray-200">Ativo</label>
          </div>
          <div class="pt-2 flex flex-col gap-2">
            <button type="submit" [disabled]="!driverForm().name?.trim()" class="w-full px-4 py-2 font-medium rounded-lg bg-blue-600 hover:bg-blue-500 text-white disabled:bg-gray-500">
              Salvar
            </button>
            @if (editingDriver()) {
              <button type="button" (click)="cancelEditing()" class="w-full px-4 py-2 text-sm font-medium rounded-lg bg-gray-600 hover:bg-gray-500 text-white">
                Cancelar Edição
              </button>
            }
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
