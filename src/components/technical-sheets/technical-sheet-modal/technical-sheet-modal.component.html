<div class="fixed inset-0 bg-black bg-opacity-75 flex justify-center items-start z-50 overflow-y-auto p-4" (click)="close.emit()">
  <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-6xl my-8 border border-gray-700" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="p-4 sm:p-6 border-b border-gray-700 flex justify-between items-center">
      <div>
        <h3 class="text-xl font-semibold text-white">
          @if (mode() === 'add') {
            Criar Nova Ficha Técnica
          } @else if (isEditing()) {
            Editar Ficha Técnica
          } @else {
            Detalhes da Ficha Técnica
          }
        </h3>
        @if(mode() !== 'add') {
          <p class="text-gray-400 text-sm mt-1">{{ recipe()?.name }}</p>
        }
      </div>
      <button (click)="close.emit()" class="p-1 rounded-full text-gray-400 hover:bg-gray-700 hover:text-white transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
      </button>
    </div>

    <!-- Content -->
    <div class="max-h-[calc(85vh-160px)] overflow-y-auto">
      @if (isEditing()) {
        <app-technical-sheet-editor 
          [initialRecipe]="recipe()"
          (save)="handleSave($event)"
          (cancel)="mode() === 'add' ? close.emit() : isEditing.set(false)">
        </app-technical-sheet-editor>
      } @else if(recipe(); as fullRecipe) {
        <app-technical-sheet-details 
          [recipe]="fullRecipe"
          (edit)="switchToEditMode()"
          (close)="close.emit()">
        </app-technical-sheet-details>
      }
    </div>
  </div>
</div>
